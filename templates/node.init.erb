#!upstart
# Node service upstart script

description "start and stop generic node service"
version "1.1"
author   "elbuo8 (Yamil Asusta)"
author   "leonmax (Yangming Huang)"

respawn
respawn limit 15 5
start on startup
stop on shutdown

pre-start script
    # Date format same as (new Date()).toISOString() for consistency
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Starting" >> <%= @logdir %>/<%= @service %>.log
end script

script
    export HOME="/root"
    #echo $$ > /var/run/<%= @service %>.pid
    chdir <%= @appdir %>
    #chdir /opt/adcade/newadworker/
    #exec sudo -u root /usr/bin/node adworkerRunner.js >> /var/log/adworker.sys.log 2>&1
    exec su -s /bin/sh -c "/usr/bin/node <%= @mainappjs %>" <%= @user %> >> <%= @logdir %>/<%= @service %>.log 2>&1
end script

pre-stop script
    rm /var/run/<%= @service %>.pid
    echo "[`date -u +%Y-%m-%dT%T.%3NZ`] (sys) Stopping" >> <%= @logdir %>/<%= @service %>.log
end script